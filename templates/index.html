{% extends 'base.html' %}

{% block head %}
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CAP Scheduler</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<script>
    var x, i, j, l, ll, selElmnt, a, b, c;
/* Look for any elements with the class "custom-select": */
x = document.getElementsByClassName("custom-select");
l = x.length;
for (i = 0; i < l; i++) {
  selElmnt = x[i].getElementsByTagName("select")[0];
  ll = selElmnt.length;
  /* For each element, create a new DIV that will act as the selected item: */
  a = document.createElement("DIV");
  a.setAttribute("class", "select-selected");
  a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
  x[i].appendChild(a);
  /* For each element, create a new DIV that will contain the option list: */
  b = document.createElement("DIV");
  b.setAttribute("class", "select-items select-hide");
  for (j = 1; j < ll; j++) {
    /* For each option in the original select element,
    create a new DIV that will act as an option item: */
    c = document.createElement("DIV");
    c.innerHTML = selElmnt.options[j].innerHTML;
    c.addEventListener("click", function(e) {
        /* When an item is clicked, update the original select box,
        and the selected item: */
        var y, i, k, s, h, sl, yl;
        s = this.parentNode.parentNode.getElementsByTagName("select")[0];
        sl = s.length;
        h = this.parentNode.previousSibling;
        for (i = 0; i < sl; i++) {
          if (s.options[i].innerHTML == this.innerHTML) {
            s.selectedIndex = i;
            h.innerHTML = this.innerHTML;
            y = this.parentNode.getElementsByClassName("same-as-selected");
            yl = y.length;
            for (k = 0; k < yl; k++) {
              y[k].removeAttribute("class");
            }
            this.setAttribute("class", "same-as-selected");
            break;
          }
        }
        h.click();
    });
    b.appendChild(c);
  }
  x[i].appendChild(b);
  a.addEventListener("click", function(e) {
    /* When the select box is clicked, close any other select boxes,
    and open/close the current select box: */
    e.stopPropagation();
    closeAllSelect(this);
    this.nextSibling.classList.toggle("select-hide");
    this.classList.toggle("select-arrow-active");
  });
}

function closeAllSelect(elmnt) {
  /* A function that will close all select boxes in the document,
  except the current select box: */
  var x, y, i, xl, yl, arrNo = [];
  x = document.getElementsByClassName("select-items");
  y = document.getElementsByClassName("select-selected");
  xl = x.length;
  yl = y.length;
  for (i = 0; i < yl; i++) {
    if (elmnt == y[i]) {
      arrNo.push(i)
    } else {
      y[i].classList.remove("select-arrow-active");
    }
  }
  for (i = 0; i < xl; i++) {
    if (arrNo.indexOf(i)) {
      x[i].classList.add("select-hide");
    }
  }
}

/* If the user clicks anywhere outside the select box,
then close all select boxes: */
document.addEventListener("click", closeAllSelect); 
</script>
{% endblock %}

{% block body %}
<div class="topnav">
    <div class="leftnav">
    <form action="/schedule">
        <input type="date" id="meetingDate" name="meetingDate" value="{{ meetingDate }}" data-date-inline-picker="true">
        <input type="submit" value="Go">
    </form>
    </div>
    <div class="centernav">
        <a href="/schedule?meetingDate={{ prevDate }}"><<</a>
        <a href="#">{{ meetingDate }}</a>
        <a href="/schedule?meetingDate={{ nextDate }}">>></a>
    </div>
    <div class="rightnav">
        <form action="navmenu-handler" method="post">
            <input type="hidden" name="referrer" value="schedule">
            <select name="destination" id="destination" onchange="this.form.submit()">
                <option value="schedule" selected>Schedule</option>
                <option value="profile">Profile</option>
                <option value="logout">Logout</option>
            </select>
        </form>
    </div>
    <div class="centernav">
        {% if status != '' %}
        <a href="">Status: {{ status }}</a>
        {% endif %}
    </div>
</div>

<div class="content">
    <!-- <h1 style="width: 80%; float: left;">Schedule</h1><h1 style="width: 20%; float: right;">Contact Hours</h1> -->
    <table id="left-table">
    <tr>
        <td></th>
        <th></th>
        <th id="detail-header" style="text-align: right;">Event&nbsp</th>
        <th id="detail-header" style="text-align: left;">&nbspDetails</th>
        <th></th>
        <th></th>
        <th id="email-header">Confirmation Emails</th>
        <th></th>
        <th></th>
    </tr>
    <tr>
        <th id="detail-header">Start</th>
        <th id="detail-header">Stop</th>
        <th id="detail-header">Event Name</th>
        <th id="detail-header">Leader</th>
        <th id="detail-header">Hours</th>
        <th id="email-header">Agreed To</th>
        <th id="email-header">Scheduled</th>
        <th id="email-header">Sent</th>
        <th id="email-header">Rcvd</th>
        <th id="email-header">Thnk</th>
        <th></th>
    </tr>
    <tr>
    {% for result in results %}
    <tr>
        <!-- Set up a single row to edit an event inline. -->
        {% if pageAction == 'EditEvent' and eventId == result[0] %}
        <form action="/edit" method="post">
        <input type="hidden" name="eventDate" value="{{ eventData[1] }}">
        <td id="detail"><input type="text" size="5" name="startTime" value="{{ eventData[2] }}"></td>
        <td id="detail"><input type="text" size="5" name="stopTime" value="{{ eventData[3] }}"></td>
        <td id="detail"><input type="text" name="eventName" value="{{ eventData[4] }}"></td>
        <td id="detail"><input type="text" name="eventLdr" value="{{ eventData[5] }}"></td>
        <td id="detail">
            <select id="contactAccount" name="contactAccount">
                {% for account in abrvs %}
                    <option value="{{ account }}" {% if eventData [6] == account %}selected{% endif %}>{{ account }}</option>
                {% endfor %}
            </select>
        </td>
        <td id="email"><input type="checkbox" name="isAgreedTo" value="1" {% if eventData[7] == 1 %}checked{% endif %}></td>
        <td id="email"><input type="checkbox" name="isEmailScheduled" value="1" {% if eventData[8] == 1 %}checked{% endif %}></td>
        <td id="email"><input type="checkbox" name="isEmailSent" value="1" {% if eventData[9] == 1 %}checked{% endif %}></td>
        <td id="email"><input type="checkbox" name="isEmailConfirmed" value="1" {% if eventData[10] == 1 %}checked{% endif %}></td>
        <td id="email"><input type="checkbox" name="isEmailThanked" value="1" {% if eventData[11] == 1 %}checked{% endif %}></td>
            <input type="hidden" name="eventId" value="{{ eventData[0] }}">
            <input type="hidden" name="isDeleted" value="0">
            <input type="hidden" name="meetingDate" value="{{ meetingDate }}">
            <input type="hidden" id="pageAction" name="pageAction" value="">
        <td>
            <a href="/schedule?meetingDate={{ meetingDate }}&pageAction=&status=Edit Cancelled">Abort</a>
            <input type="submit" onclick="return confirm('Are you sure you want to edit this event with the values in the fields below?')" value="Submit"></td>
        </form>        
        {% else %} <!-- Show the events regularly, without editing. -->
        {% for elem in result %}
        {% if elem != result[0] and elem != result[1] %}
                {% if elem == '0' %}
                    <td id="email" style="color: red;">&#9744</td>
                {% else %}
                    {% if elem == '1' %}
                    <td id="email" style="color: green">&#9745</td>
                    {% else %}
                        <td id="detail">{{ elem }}</td>
                    {% endif %}
                {% endif %}
        {% endif %}
        {% endfor %}
        <td>
            <a href="/schedule?meetingDate={{ meetingDate }}&eventId={{ result[0] }}&pageAction=EditEvent">&nbsp&nbspEdit&nbsp&nbsp</a>
            <a href="/delete?meetingDate={{ meetingDate }}&eventId={{ result[0] }}">Delete</a>
        </td>
        {% endif %}
    </tr>
    {% endfor %}
    </tr>

    <!-- Set up the page for when it detects an AddEvent status. -->
    {% if pageAction == 'AddEvent' %}
        <form action="/newevent?meetingDate={{ meetingDate }}">
            <tr>
                <input type="hidden" name="eventDate" value="{{ meetingDate }}">
                <td><input type="text" size="6" name="startTime" value=""></td>
                <td><input type="text" size="6" name="stopTime" value=""></td>
                <td><input type="text" name="eventName" value=""></td>
                <td><input type="text" name="eventLdr" value=""></td>
                <td>
                    <select id="contactAccount" name="contactAccount">
                        {% for account in abrvs %}
                            <option value="{{ account }}">{{ account }}</option>
                        {% endfor %}
                    </select>
                </td>
                <td>
                    <input type="checkbox" id="isAgreedTo" name="isAgreedTo" value="1">
                </td>
                <td>
                    <input type="checkbox" id="isEmailScheduled" name="isEmailScheduled" value="1">
                </td>
                <td>
                    <input type="checkbox" id="isEmailSent" name="isEmailSent" value="1">
                </td>
                <td>
                    <input type="checkbox" id="isEmailConfirmed" name="isEmailConfirmed" value="1">
                </td>
                <td>
                    <input type="checkbox" id="isEmailThanked" name="isEmailThanked" value="1">
                </td>
                <td>
                    <input type="hidden" id="pageAction" name="pageAction" value="">
                    <input type="hidden" id="isDeleted" name="isDeleted" value="0">
                    <input type="hidden" id="meetingDate" name="meetingDate" value="{{ meetingDate }}">
                    <!-- <input type="reset" value="Clear"> -->
                    <a href="/schedule?meetingDate={{ meetingDate }}&eventId=&pageAction=&status=Add Event Cancelled">Abort</a>
                    <input type="submit" value="Submit">
                </td>
            </tr>
        </form>
    </table>
    {% else %}
    {% for n in range(9) %}
    <td></td>
    {% endfor %}
    <td></td>
    <td><a href="/schedule?meetingDate={{ meetingDate }}&pageAction=AddEvent">Add Event</a></td>
    {% endif %}
    <table id="right-table">
        <tr>
            <td></td>
            <th>D</th>
            <th>M</th>
        </tr>
        {% for i in range(0, abrvs | length) %}
            <tr>
                <th><b>{{ abrvs[i] }}</b></th>
                <td>{{ minutes[i] }}</td>
                {% if abrvs[i] not in ['AE', 'CD', 'PT', 'LD'] %}<td>{{ mminutes[i] }}</td>
                {% elif abrvs[i] == 'AE' and mminutes[i] < 90 %}<td style="color: red;">{{ mminutes[i] }}</td>
                {% elif abrvs[i] == 'CD' and mminutes[i] < 60 %}<td style="color: red;">{{ mminutes[i] }}</td>
                {% elif abrvs[i] == 'PT' and mminutes[i] < 60 %}<td style="color: red;">{{ mminutes[i] }}</td>
                {% elif abrvs[i] == 'LD' and mminutes[i] < 90 %}<td style="color: red;">{{ mminutes[i] }}</td>
                {% else %}
                    <td style="color: green;">{{ mminutes[i] }}</td>
                {% endif %}
            </tr>
        {% endfor %}
    </table>
    <a href="/recalculatestats?meetingDate={{ meetingDate}}" id="right-table">Recalculate Stats</a>
</div>
</div>
{% endblock %}